#! /usr/bin/env nix-shell
#! nix-shell -p jq -i bash

set -e

BASE=$(dirname "$0")

INPUT=$(cat)
RAWASTS=$(echo  "$INPUT" | jq -c '.asts')
RAWTYPES=$(echo "$INPUT" | jq -r '.result')
RAWSCOPE=$(echo "$INPUT" | jq -r '.scoperesult')

echo "$RAWASTS" |
    "$BASE/tagAsts" <(echo "$RAWSCOPE" | "$BASE/getTypes")   |
    "$BASE/tagAsts" <(echo "$RAWTYPES" | "$BASE/getArities")
